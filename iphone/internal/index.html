<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Tafelsalz  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="Tafelsalz  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          Tafelsalz Docs
        </a>
         (96% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/blochberger/Tafelsalz">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">Tafelsalz Reference</a>
      <img class="carat" src="img/carat.png" />
      Tafelsalz  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/GenericHash.html">GenericHash</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/GenericHash/Key.html">– Key</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/KeyExchange.html">KeyExchange</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/KeyExchange/Side.html">– Side</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/KeyExchange/PublicKey.html">– PublicKey</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/KeyExchange/SessionKey.html">– SessionKey</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/KeyExchange/SessionKeyPair.html">– SessionKeyPair</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/KeyMaterial.html">KeyMaterial</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MasterKey.html">MasterKey</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MasterKey/Context.html">– Context</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/MasterKey/DerivedKey.html">– DerivedKey</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Memory.html">Memory</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Password.html">Password</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Password/ComplexityLimit.html">– ComplexityLimit</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Password/MemoryLimit.html">– MemoryLimit</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Persona.html">Persona</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Persona/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/Persona/KeyType.html">– KeyType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/SecretBox.html">SecretBox</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/SecretBox/SecretKey.html">– SecretKey</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/SecretBox/Nonce.html">– Nonce</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/SecretBox/AuthenticationCode.html">– AuthenticationCode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/SecretBox/AuthenticatedCiphertext.html">– AuthenticatedCiphertext</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Global Variables.html">Global Variables</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Global Variables.html#/s:9Tafelsalz6sodiumAA6SodiumVv">sodium</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Data.html">Data</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/EncryptedData.html">EncryptedData</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Ciphertext.html">Ciphertext</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/HashedPassword.html">HashedPassword</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Random.html">Random</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Sodium.html">Sodium</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Sodium/GenericHash.html">– GenericHash</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Sodium/KeyDerivation.html">– KeyDerivation</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Sodium/KeyExchange.html">– KeyExchange</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Sodium/Memory.html">– Memory</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Sodium/PasswordHash.html">– PasswordHash</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Sodium/RandomBytes.html">– RandomBytes</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/Sodium/SecretBox.html">– SecretBox</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <h1 id='tafelsalz' class='heading'>Tafelsalz</h1>

<p><img src="https://blochberger.github.io/Tafelsalz/macos/coverage.svg" alt="Coverage"> <a href="https://blochberger.github.io/Tafelsalz"><img src="https://blochberger.github.io/Tafelsalz/macos/public/badge.svg" alt="Documentation"></a></p>

<p>The main idea of this project is to provide usable but safe cryptographic operations.</p>

<p>The <a href="https://libsodium.org"><em>libsodium</em></a> project has a similar goal, but does not leverage the features available in modern programming languages such as Swift. The <em>libsodium</em> library is based on <a href="https://nacl.cr.yp.to">NaCl</a> whoose authors discussed the security issues related to cryptographic APIs that are too complicated and error-prone¹ – or as Matthew Green² put it:</p>

<blockquote>
<p>OpenSSL is the space shuttle of crypto libraries. It will get you to space, provided you have a team of people to push the ten thousand buttons required to do so. NaCl is more like an elevator — you just press a button and it takes you there. No frills or options.</p>

<p>I like elevators.</p>
</blockquote>

<p>To stay with the analogy: <em>libsodium</em> and <em>NaCl</em> prevent any accidents to happen if you press a button for some floor which isn&rsquo;t there. This project tries to prevent the button being there in the first place.</p>

<p>This is achieved by leveraging programming language features in a way that an operation cannot be called with invalid or insecure parameters. Every such call should be prevented at compile time already.</p>

<p>Note that the goal is not to prevent malicious attackers to circumvent the established protection mechanisms by the programming language features but to prevent accidental misuse of cryptographic APIs. If you want to learn more about cryptographic misuse, see our <a href="https://github.com/blochberger/Tafelsalz/wiki/References#cryptographic-misuse">literature collection on cryptographic misuse</a>.</p>

<ul>
<li>Repository: <a href="https://github.com/blochberger/Tafelsalz">https://github.com/blochberger/Tafelsalz</a></li>
<li>Documentation: <a href="https://blochberger.github.io/Tafelsalz">https://blochberger.github.io/Tafelsalz</a>

<ul>
<li>macOS: <a href="https://blochberger.github.io/Tafelsalz/macos/public">public</a>, <a href="https://blochberger.github.io/Tafelsalz/macos/internal">internal</a>, <a href="https://blochberger.github.io/Tafelsalz/macos/private">private</a></li>
<li>iOS: <a href="https://blochberger.github.io/Tafelsalz/iphone/public">public</a>, <a href="https://blochberger.github.io/Tafelsalz/iphone/internal">internal</a>, <a href="https://blochberger.github.io/Tafelsalz/iphone/private">private</a></li>
</ul></li>
<li>Issues: <a href="https://github.com/blochberger/Tafelsalz/issues">https://github.com/blochberger/Tafelsalz/issues</a></li>
</ul>

<p>Check out the project with:</p>
<pre class="highlight shell"><code>git clone <span class="nt">--recursive</span> https://github.com/blochberger/Tafelsalz.git
</code></pre>

<p>⚠️ <strong>WARNING</strong>: This project will not provide backwards compatibility. The API might change with the purpose of improving it. Changes should stabilize over time. If you need a more backwards compatible framework, I suggest to use <a href="https://github.com/jedisct1/swift-sodium">jedisct1/swift-sodium</a>.</p>
<h2 id='concept' class='heading'>Concept</h2>

<p>There are several basic ideas:</p>

<ul>
<li>Let the compiler catch/enforce as much as possible.</li>
<li>Avoid common mistakes.</li>
<li>Combine convenience and security.</li>
</ul>
<h3 id='identity-management' class='heading'>Identity Management</h3>

<p>There are basically two different kinds of identities or actors: personas and contacts. For personas you are in posession of the secret keys. For contacts you are only in possession of the public keys.</p>
<h3 id='persistence-of-secrets' class='heading'>Persistence of Secrets</h3>

<p>The secrets for personas are automatically persisted in the system&rsquo;s Keychain. This is the place, where you want to store your secrets, as storing them in the file system might lead to them being compromised easily.</p>
<h2 id='examples' class='heading'>Examples</h2>
<h3 id='symmetric-encryption' class='heading'>Symmetric Encryption</h3>
<h4 id='ephemeral-keys' class='heading'>Ephemeral Keys</h4>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">secretBox</span> <span class="o">=</span> <span class="nf">SecretBox</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">plaintext</span> <span class="o">=</span> <span class="nf">Data</span><span class="p">(</span><span class="s">"Hello, World!"</span><span class="o">.</span><span class="n">utf8</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">ciphertext</span> <span class="o">=</span> <span class="n">secretBox</span><span class="o">.</span><span class="nf">encrypt</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">plaintext</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">decrypted</span> <span class="o">=</span> <span class="n">secretBox</span><span class="o">.</span><span class="nf">decrypt</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">ciphertext</span><span class="p">)</span><span class="o">!</span>
</code></pre>
<h4 id='persisted-keys' class='heading'>Persisted Keys</h4>
<pre class="highlight swift"><code><span class="c1">// Create a persona</span>
<span class="k">let</span> <span class="nv">alice</span> <span class="o">=</span> <span class="nf">Persona</span><span class="p">(</span><span class="nv">uniqueName</span><span class="p">:</span> <span class="s">"Alice"</span><span class="p">)</span>

<span class="c1">// Once a secret of that persona is used, it will be persisted in the</span>
<span class="c1">// system's Keychain.</span>
<span class="k">let</span> <span class="nv">secretBox</span> <span class="o">=</span> <span class="nf">SecretBox</span><span class="p">(</span><span class="nv">persona</span><span class="p">:</span> <span class="n">alice</span><span class="p">)</span><span class="o">!</span>

<span class="c1">// Use your SecretBox as usual</span>
<span class="k">let</span> <span class="nv">plaintext</span> <span class="o">=</span> <span class="nf">Data</span><span class="p">(</span><span class="s">"Hello, World!"</span><span class="o">.</span><span class="n">utf8</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">ciphertext</span> <span class="o">=</span> <span class="n">secretBox</span><span class="o">.</span><span class="nf">encrypt</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">plaintext</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">decrypted</span> <span class="o">=</span> <span class="n">secretBox</span><span class="o">.</span><span class="nf">decrypt</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">ciphertext</span><span class="p">)</span><span class="o">!</span>

<span class="c1">// Forget the persona and remove all related Keychain entries</span>
<span class="k">try!</span> <span class="kt">Persona</span><span class="o">.</span><span class="nf">forget</span><span class="p">(</span><span class="n">alice</span><span class="p">)</span>
</code></pre>
<h3 id='password-hashing' class='heading'>Password Hashing</h3>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">password</span> <span class="o">=</span> <span class="nf">Password</span><span class="p">(</span><span class="s">"Correct Horse Battery Staple"</span><span class="p">)</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">hashedPassword</span> <span class="o">=</span> <span class="n">password</span><span class="o">.</span><span class="nf">hash</span><span class="p">()</span><span class="o">!</span>

<span class="c1">// Store `hashedPassword.string` to database.</span>

<span class="c1">// If a user wants to authenticate, just read it from the database and</span>
<span class="c1">// verify it against the password given by the user.</span>
<span class="k">if</span> <span class="n">hashedPassword</span><span class="o">.</span><span class="nf">isVerified</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="n">password</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// The user is authenticated successfully.</span>
<span class="p">}</span>
</code></pre>
<h3 id='generic-hashing' class='heading'>Generic Hashing</h3>
<h4 id='public-hashing' class='heading'>Public Hashing</h4>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="nf">Data</span><span class="p">(</span><span class="s">"Hello, World!"</span><span class="o">.</span><span class="n">utf8</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">hash</span> <span class="o">=</span> <span class="nf">GenericHash</span><span class="p">(</span><span class="nv">bytes</span><span class="p">:</span> <span class="n">data</span><span class="p">)</span>
</code></pre>
<h4 id='private-hashing-with-persisted-keys' class='heading'>Private Hashing with Persisted Keys</h4>
<pre class="highlight swift"><code><span class="c1">// Create a persona</span>
<span class="k">let</span> <span class="nv">alice</span> <span class="o">=</span> <span class="nf">Persona</span><span class="p">(</span><span class="nv">uniqueName</span><span class="p">:</span> <span class="s">"Alice"</span><span class="p">)</span>

<span class="c1">// Generate a personalized hash for that persona</span>
<span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="nf">Data</span><span class="p">(</span><span class="s">"Hello, World!"</span><span class="o">.</span><span class="n">utf8</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">hash</span> <span class="o">=</span> <span class="nf">GenericHash</span><span class="p">(</span><span class="nv">bytes</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">for</span><span class="p">:</span> <span class="n">alice</span><span class="p">)</span>

<span class="c1">// Forget the persona and remove all related Keychain entries</span>
<span class="k">try!</span> <span class="kt">Persona</span><span class="o">.</span><span class="nf">forget</span><span class="p">(</span><span class="n">alice</span><span class="p">)</span>
</code></pre>
<h3 id='key-derivation' class='heading'>Key Derivation</h3>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">context</span> <span class="o">=</span> <span class="kt">MasterKey</span><span class="o">.</span><span class="nf">Context</span><span class="p">(</span><span class="s">"Examples"</span><span class="p">)</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">masterKey</span> <span class="o">=</span> <span class="nf">MasterKey</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">subKey1</span> <span class="o">=</span> <span class="n">masterKey</span><span class="o">.</span><span class="nf">derive</span><span class="p">(</span><span class="nv">sizeInBytes</span><span class="p">:</span> <span class="kt">MasterKey</span><span class="o">.</span><span class="kt">DerivedKey</span><span class="o">.</span><span class="kt">MinimumSizeInBytes</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">and</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">subKey2</span> <span class="o">=</span> <span class="n">masterKey</span><span class="o">.</span><span class="nf">derive</span><span class="p">(</span><span class="nv">sizeInBytes</span><span class="p">:</span> <span class="kt">MasterKey</span><span class="o">.</span><span class="kt">DerivedKey</span><span class="o">.</span><span class="kt">MinimumSizeInBytes</span><span class="p">,</span> <span class="nv">with</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">and</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span><span class="o">!</span>

<span class="c1">// You can also derive a key in order to use it with secret boxes</span>
<span class="k">let</span> <span class="nv">secretBox</span> <span class="o">=</span> <span class="nf">SecretBox</span><span class="p">(</span><span class="nv">secretKey</span><span class="p">:</span> <span class="n">masterKey</span><span class="o">.</span><span class="nf">derive</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">and</span><span class="p">:</span> <span class="n">context</span><span class="p">))</span>
</code></pre>
<h3 id='key-exchange' class='heading'>Key Exchange</h3>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">alice</span> <span class="o">=</span> <span class="nf">KeyExchange</span><span class="p">(</span><span class="nv">side</span><span class="p">:</span> <span class="o">.</span><span class="n">client</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">bob</span> <span class="o">=</span> <span class="nf">KeyExchange</span><span class="p">(</span><span class="nv">side</span><span class="p">:</span> <span class="o">.</span><span class="n">server</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">alicesSessionKey</span> <span class="o">=</span> <span class="n">alice</span><span class="o">.</span><span class="nf">sessionKey</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">bob</span><span class="o">.</span><span class="n">publicKey</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">bobsSessionKey</span> <span class="o">=</span> <span class="n">bob</span><span class="o">.</span><span class="nf">sessionKey</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">alice</span><span class="o">.</span><span class="n">publicKey</span><span class="p">)</span>

<span class="c1">// alicesSessionKey == bobsSessionKey</span>
</code></pre>

<hr>

<ol>
<li>D. J. Bernstein, T. Lange, and P. Schwabe, <a href="http://dx.doi.org/10.1007/978-3-642-33481-8_9"><strong>The Security Impact of a New Cryptographic Library</strong></a> in <em>Progress in Cryptology – LATINCRYPT 2012 – 2nd International Conference on Cryptology and Information Security in Latin America, Santiago, Chile, October 7-10, 2012. Proceedings</em> (A. Hevia and G. Neven, eds.), pp. 159–176</li>
<li>M. Green, <a href="http://blog.cryptographyengineering.com/2012/12/the-anatomy-of-bad-idea.html"><strong>The Anatomy of a Bad Idea</strong></a>, 2012</li>
</ol>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2018 <a class="link" href="https://github.com/blochberger" target="_blank" rel="external">Maximilian Blochberger</a>. All rights reserved. (Last updated: 2018-01-16)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.1</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
